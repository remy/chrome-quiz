<!DOCTYPE html>
<html lang="en">
<head>
<meta charset=utf-8 />
<title>Chrome Dev Tools Challenge</title>
<link href='http://fonts.googleapis.com/css?family=Droid+Sans:regular&amp;subset=latin' rel='stylesheet' type='text/css'>
<style>
body, html {
  border: 0px;
  color: #333;
  font-family: 'Droid Sans', arial, serif;
  font-size: 16px;
  line-height: 150%;
  margin: 0px;
  padding: 0px;
  background: #d4e5f7;
  -webkit-font-smoothing: antialiased;
}

body {
  padding-bottom: 20px;
  overflow-x: hidden;
  background: #d4e5f7;
}

#content {
  width: 610px;
  margin: 10px auto;
  background: #fff;
  position: relative;
}

h1 { 
  background: #fff;
  font-size: 36px;
  line-height: 50px;
  margin: 0;
  padding: 0.67em 0px;
  text-align: center;
  z-index: 2;
  position: relative;
}

#content > h1 {
  background: url(/wrench.png) no-repeat 570px center;
}

h2, p, .social-links {
  width: 520px;
  margin: 0 auto;
}

h2 {
  font-size: 1.5em;
  font-weight: bold;
  color: #666;
  font-weight: normal;
  margin-top: 40px;
  margin-bottom: 10px;
}

label {
  font-weight: bold;
}

input {
  font-family: sans-serif;
  font-size: 18px;
  line-height: 22px;
  padding: 4px 2px;
  border: 0;
  border-bottom: 2px solid #000;
/*  background: rgba(250,43,194,.15);*/
  outline: none;
}

input:hover,
input:focus {
  background: #F5F7BB;
}

.button {
  display: block;
  margin: 40px auto 0;
  cursor: pointer;
  background: none;
  background: -moz-linear-gradient(0% 100% 90deg, #EEEFEE, #F8F8F8);
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(0%,#F8F8F8), color-stop(5%,#F8F8F8), color-stop(15%,#F2F2F2), color-stop(100%,#EEEFEE));
  border: 2px solid #b2b6bd;
  -moz-border-radius: 5px;
  -webkit-border-radius: 5px;
  border-radius: 8px;
  color: #000;
/*  font-family: "helvetica neue", helvetica, arial, sans-serif;*/
  font-size: 12px;
  font-weight: bold;
  line-height: 1;
  padding: 15px 20px;
  text-align: center;
/*  text-transform: uppercase;*/
  width: 200px;
  text-decoration: none;
}

.button:hover {
/*  background: #F300BD;*/
  background: none;
  background: -moz-linear-gradient(0% 100% 90deg, #EEEFEE, #EEEFEE);
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#EEEFEE), to(#EEEFEE));
}

.taskscomplete #send {
  color: #fff;
  background: none;
  background: -moz-linear-gradient(0% 100% 90deg, #1E8800, #41E300);
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#41E300), to(#1E8800));
  border: 2px solid #258000;
  box-shadow: inset 0 1px 0 0 #65DC00;
  -moz-box-shadow: inset 0 1px 0 0 #65DC00;
  -webkit-box-shadow: inset 0 1px 0 0 #65DC00;
}

.taskscomplete #send:hover {
  background: none;
  background: -moz-linear-gradient(0% 100% 90deg, #144900, #41E300);
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#41E300), to(#144900));
}

.taskscomplete #send:active,
.taskscomplete #send:focus {
  background: none;
  background: -moz-linear-gradient(0% 100% 90deg, #41E300, #1E8800);
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#1E8800), to(#41E300));
  box-shadow: none;
  -moz-box-shadow: none;
  -webkit-box-shadow: none;
}

.buttons {
  text-align: center;
}

.buttons .button {
  display: inline-block;
  margin: 40px 10px;
}

.buttons .button:first-child {
  width: 100px;
}

section {
  border: 1px solid #ccc;
  width: 100%;
  position: absolute;
  top: 0;
  padding-top: 100px;
  padding-bottom: 20px;
  left: 0;
/*  opacity: 0;*/
  background: #fff;
/*  min-height: 100%;*/
  top: -1000%;
  -webkit-transform: translate(0, -100%);
  -webkit-transition-property: translate;
  -webkit-transition-duration: 200ms;
  -webkit-transition-timing-function: ease-out;
}

section:first-of-type,
section:target {
  top: 0;
  opacity: 1;
  -webkit-transform: translate(0, 0);
}

form > div:not(.buttons) {
  opacity: 0;
  -webkit-transition: opacity 200ms ease-out;
}

.task1 .task1,
.task2 .task2,
.task3 .task3,
.task4 .task4,
.task5 .task5 {
  opacity: 1;
}

#thankyou {
  padding: 200px 0;
}

#thankyou h1 {
  font-size: 50px;
}

#thankyou h2 {
  text-align: center;
  color: #000;
}

#quiz {
  counter-reset: id;
}
 
#quiz h2:before {
  content: counter(id) '. ';
  counter-increment: id;
}

.social-links {
  margin-top: 20px;
}

.social-links a:hover {
  background: none;
}

.social-links .c1,
.social-links .c2 {
  display: inline;
}

#tweetthis {
  height: 20px;
  padding-top: 7px;
  width: 130px;
}

iframe {
  border: 0;
  margin: 0;
  padding: 0;
}

</style>
</head>
<body>
  <div id="content">
    <h1>Chrome Dev Tools Challenge</h1>
    <section id="welcome">
      <h2>Get started</h2>
      {% if save %}
      <p>Complete the following Developer Tools quiz to claim your free Chrome gift at the upcoming Google Developer Day or DevFest! Not attending an event? Take the quiz any way!</p>

      <p>Enter your name below and complete the quiz. Good luck!</p>
      <p><label for="name">Your name:</label> <input data-next="#quiz" type="text" id="name" /></p>
      {% else %}
      <p>Complete the following Developer Tools quiz to prove you're a web app ace!</p>
      {% endif %}
      <div id="getchrome">
      <h2>Get your hands on Google Chrome</h2>
      <p>Either open up Google Chrome, or go download <a href="http://www.google.com/chrome/">Chrome</a>, and come back here for the best chance of completing this quiz.</p>
      <script>
      // yes, that's right, we're user agent sniffing. it's because
      // we *really* want this particular user to use Chrome, and
      // frankly if they're smart enough to change the user agent,
      // then this quiz is going to be a cakewalk for them.
      if (/chrome/i.test(navigator.userAgent)) {
        document.getElementById('getchrome').style.display = 'none';
      } 
      </script>
      </div>

      <h2>A free tip!</h2>
      <p>You'll want to break open the <a target="_blank" href="http://www.chromium.org/devtools">Developer Tools</a> in Google Chrome to complete the quiz.</p>
      <a class="button" href="#quiz">Get me to the quiz &raquo;</a>
    </section>
    <section id="quiz">
      <form id="quizForm" action="/save" method="get">
        <p><em>As you successfully answer a question the next one will be revealed.</em></p>
        <div class="task1">
          <h2>Resources</h2>
          <p><label for="docsize">Enter the size of <em>this particular document</em> in KB:</label> <input type="number" id="docsize" data-next="#sp" size="5" value="0.00" min="0" step="0.01" /></p>
          <p><small>Tip: select the Documents filter from the Resources tab</small></p>
        </div>
        <div class="task2">
          <h2>Style manipulation</h2>
          <p>Change the font size of this page's title to exactly 18px</p>      
        </div>
        <div class="task3">
          <h2>DOM manipulation</h2>
          <p>Edit the html&hellip;adding a new element or tweaking some on-page text</p>
        </div>
        <div class="task4">
          <h2>Variables</h2>
          <p><label for="sp">Enter the value of <code>secretPass</code>:</label> <input data-next="#profile" id="sp" type="text" /></p>
          <p><small>Tip: inside the Console tab</small></p>
        </div>
        <div class="buttons">
          <a class="back button" href="#welcome">&laquo; Back</a>
          <input class="button" type="submit" id="send" value="I want my free gift! &raquo;" />
        </div>
      </form>
    </section> 
    <section id="thankyou">
      <h1>...and you're <em>done!</em></h1>
      {% if save %}
      <div id="completed">
        <h2>Your gift code: <span id="code">not ready yet - <em>please complete the quiz</em></span></h2>
        <p>Please take note of your gift code above, you'll need it to collect your gift on the day of the event! (Please note that all names will be deleted after you have claimed your free Chrome gift).</p>        
      </div>
      {% endif %}
      <p>Tell everyone that you've aced the quiz!</p>
      
      <div class="social-links"> 
        <a data-g-event="tweet_icon" href="http://twitter.com/home?status=I%20just%20passed%20the%20Google%20#ChromeDevTools%20Quiz!%20http://chromedevtools.appspot.com/{{ url }}" target="_blank"><img alt="Twitter" src="//www.google.com/images/icons/thirdparty/twitter-16.gif"></a> 

        <a data-g-event="buzz_icon" href="http://www.google.com/buzz/post?message=I%20just%20passed%20the%20Google%20#ChromeDevTools%20Quiz!%20&amp;url=http://chromedevtools.appspot.com/{{ url }}" target="_blank"><img alt="Buzz" src="//www.google.com/images/icons/buzz-16.png"></a>

        <a data-g-event="fb_icon" href="http://www.facebook.com/sharer.php?u=http://chromedevtools.appspot.com/{{ url }}&amp;t=I%20just%20passed%20the%20Google%20#ChromeDevTools%20Quiz!%20" target="_blank"><img alt="Facebook" src="//www.google.com/images/icons/thirdparty/facebook-16.gif"></a>

        <div class="c1" data-g-event="orkut_icon" id="orkut_share"></div>
        <script src="http://www.google.com/jsapi"></script>
        <script> 
      google.load("orkut.share", "1");google.setOnLoadCallback(function(){new google.orkut.share.Button({style:google.orkut.share.Button.STYLE_MINI,title:unescape("I%20just%20passed%20the%20Google%20#ChromeDevTools%20Quiz!%20")}).draw("orkut_share");}, true);
        </script> 

        <div class="c2" id="orkut_share_full"></div>
        <script src="http://www.google.com/jsapi"></script>
        <script> 
        google.load("orkut.share", "1");google.setOnLoadCallback(function(){new google.orkut.share.Button({style:google.orkut.share.Button.STYLE_REGULAR,title:unescape("I%20just%20passed%20the%20Google%20#ChromeDevTools%20Quiz!%20")}).draw("orkut_share_full");}, true);
        </script> 

        <iframe id="tweetthis" scrolling="no" src="//google-io.googlecode.com/hg/gdd-tweet-this.html#sao-paulo"></iframe> 
      </div>
    </section>
  </div>
<script>
// Chrome test game
(function (window, document) {

var completed = !!!(document.getElementById('completed'));

window.quiz = (function () {

var tasks = {},
    send = document.getElementById('send'),
    secretPass = (+new Date).toString(32).substr(3).toUpperCase(),
    ntasks = 0;

function task(id, fn) {
  ntasks++;
  tasks[id] = function () {
    fn.call(fn, function () {
      showTask(id+1);
    });
  };
}

// doc size
task(1, function (next) {
  // this was originally an xhr request on itself (via window.location)
  // calculating the size of the doc, but we've had to now hard code these
  // values - please change these if the size is different!
  var sizes = {
    104.19: true, // total size of all assets
    26.82: true // total size of documents
    102.55: true, // these are the sizes when the quiz doesn't save
    25.17: true
  };
  
  var xhr = new XMLHttpRequest();

  xhr.onreadystatechange = function () {
    if (this.readyState == 4 && this.status == 200) {
      // just this document
      sizes[(this.responseText.length / 1024).toFixed(2)] = true;
    }
  };

  xhr.open("GET", window.location, false);
  xhr.send();

  function test() {
    if (sizes[this.value] === true) {
      next();
      taskvalue.removeEventListener('keyup', test, false);
    }
  }
  
  taskvalue = document.getElementById('docsize');
  
  // not using the change event, because the input[type=number] 
  // doesn't increment by 0.10 - but rather integers :(
  taskvalue.addEventListener('keyup', test, false);
});

// Style manip
task(2, function (next) {
  var h1 = document.querySelector('h1'),
      comp = document.defaultView.getComputedStyle(h1, null);

  (function checkfontsize(){
    if (comp['font-size'] == '18px') {
       next();
       return;
    }
    setTimeout(checkfontsize, 200);
  })();
});

// DOM manip
task(3, function (next) {
  function handler(event) {
    document.removeEventListener('DOMCharacterDataModified', handler, true);
    document.removeEventListener('DOMNodeInserted', handler, true);
    next();
  }
  
  document.addEventListener('DOMCharacterDataModified', handler, true);
  document.addEventListener('DOMNodeInserted', handler, true);
});

// secretPass
task(4, function (next) {
  // should have been done this way
  window.__defineGetter__("secretPass", function() {
    return secretPass;
  });
  
  function complete() {
    if (this.value == secretPass) {
      next();
      sp.removeEventListener('keyup', complete, false);
    }
  }
  
  var sp = document.getElementById('sp');
  sp.addEventListener('keyup', complete, false);
});

// profile
if (false) task(null, function (next) {
  function complete() {
    if (this.value == 'omgomg') {
      next();
      profile.removeEventListener('keyup', complete, false);
    }
  }
  
  var profile = document.getElementById('profile');
  profile.addEventListener('keyup', complete, false);
});

// end
task(5, function () {}); // not quite convinced I need this

function showTask(id) {
  if (tasks[id] !== undefined) {
    document.body.className += ' task' + id;
    tasks[id]();
    delete tasks[id];

    // last stage
    if (id == ntasks) {
      document.body.className += ' taskscomplete';
      {% if save %}
      send.value = 'Go get your free gift! »'; // not an xml entity
      {% else %}
      send.value = 'Yay - you did it! »';
      {% endif %}
    } else if (id < (ntasks-2)) {
      send.value = 'Just ' + (ntasks-id) + ' tasks to go...';
    } else if (id < ntasks) {
      send.value = 'Almost there, ' + (ntasks-id) + ' left!';
    }
  }
}

function omgomg() {
  // purposely wasteful - to try and consume some browser time
  "a"+"b"+"c"+"d"+"e"+"f"+"g"+"h"+"i"+"j"+"k"+"l"+"m"+"n"+"o"+"p"+"q"+"r"+"s"+"t"+"u"+"v"+"w"+"x"+"y"+"z"+"a"+"b"+"c"+"d"+"e"+"f"+"g"+"h"+"i"+"j"+"k"+"l"+"m"+"n"+"o"+"p"+"q"+"r"+"s"+"t"+"u"+"v"+"w"+"x"+"y"+"z"+"a"+"b"+"c"+"d"+"e"+"f"+"g"+"h"+"i"+"j"+"k"+"l"+"m"+"n"+"o"+"p"+"q"+"r"+"s"+"t"+"u"+"v"+"w"+"x"+"y"+"z"+"a"+"b"+"c"+"d"+"e"+"f"+"g"+"h"+"i"+"j"+"k"+"l"+"m"+"n"+"o"+"p"+"q"+"r"+"s"+"t"+"u"+"v"+"w"+"x"+"y"+"z"+"a"+"b"+"c"+"d"+"e"+"f"+"g"+"h"+"i"+"j"+"k"+"l"+"m"+"n"+"o"+"p"+"q"+"r"+"s"+"t"+"u"+"v"+"w"+"x"+"y"+"z"+"a"+"b"+"c"+"d"+"e"+"f"+"g"+"h"+"i"+"j"+"k"+"l"+"m"+"n"+"o"+"p"+"q"+"r"+"s"+"t"+"u"+"v"+"w"+"x"+"y"+"z";
 

  if (!window.okstop) setTimeout(omgomg, 20);
}

omgomg();

showTask(1);

return function () {
  for (var key in tasks) {
    return false;
  }
  return true;
};

})();

[].forEach.call(document.querySelectorAll('input[data-next]'), function (input) {
  input.addEventListener('keydown', function (event) {
    if (event.which == 13) {
      var next = document.getElementById(this.getAttribute('data-next').substr(1));
      if (next.nodeName === 'INPUT') {
        next.focus();
      } else {
        window.location = '#' + next.id;
      }
      event.preventDefault();
    }
  }, false);
});

document.getElementById('quizForm').addEventListener('submit', function (event) {
  event.preventDefault();

  if (quiz()) {
{# This is so, so wrong, mixing JavaScript and Python templating - but we wanted to hide this code, so this is the way we're doing it. Sorry! #}
{% if save %}
    if (!completed) {
      var xhr = new XMLHttpRequest();

      xhr.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          if (this.responseText == '1') {
            // it worked
            document.getElementById('code').innerHTML = secretPass;
            window.location = '#thankyou';
          } else {
            // something went wrong
            console.log('something went wrong...');
          }
        }
      };

      var ua = navigator.userAgent.match(/Chrome\/([\d\.]+)/);

      var params = [];
      params.push('name=' + encodeURIComponent(document.getElementById('name').value));
      params.push('code=' + secretPass.toUpperCase());
      params.push('datetime=' + encodeURIComponent(new Date));
      params.push('chrome=' + (ua === null ? 'false' : ua[1]));

      xhr.open("POST", '/save');
      xhr.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
      xhr.send(params.join('&'));
      
      completed = true;      
    } else {
      window.location = '#thankyou';
    }
{% else %}
    window.location = '#thankyou';
{% endif %}
  } else {
    console.log('quiz not complete');
  }
}, false);  

})(this, document);
</script>
</body>
</html>